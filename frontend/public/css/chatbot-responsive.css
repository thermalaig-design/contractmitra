/* ==================== CHATBOT RESPONSIVE CSS - COMPLETE FILE ==================== */

/* ==================== MOBILE UI FIX - SMALL SCREENS ONLY ==================== */

/* ===== 1. FIX TOP NAVBAR OVERLAP ===== */
@media (max-width: 480px) {
    /* Reset everything */
    * {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        padding: 0;
        overflow-x: hidden;
    }

    /* Ensure top nav stays fixed at top */
    .top-nav {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        height: 64px !important;
        z-index: 1003 !important;
        background: white !important;
        border-bottom: 1px solid #e5e7eb !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
    }

    /* ===== 2. FIX SIDEBAR TOGGLE BUTTON POSITION ===== */
    .sidebar-toggle {
        position: fixed !important;
        top: 500px !important; /* Moved down by 8px */
        left: 16px !important;
        z-index: 1002 !important;
        background: #2563eb !important;
        color: white !important;
        border: none !important;
        border-radius: 48px !important;
        padding: 10px 14px !important;
        font-size: 20px !important;
        font-weight: bold !important;
        cursor: pointer !important;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3) !important;
        min-width: 48px !important;
        min-height: 48px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        transition: all 0.2s ease !important;
        visibility: visible !important; /* Ensure button is visible */
    }

    .sidebar-toggle:hover {
        background: #1d4ed8 !important;
        transform: scale(1.05) !important;
    }

    .sidebar-toggle:active {
        transform: scale(0.95) !important;
    }

    /* ===== 3. FIX MAIN SIDEBAR (NAVIGATION) ===== */
    .sidebar {
        position: fixed !important;
        top: 64px !important; /* Below top nav */
        left: -100% !important; /* Hidden by default */
        width: 280px !important;
        height: calc(100vh - 64px) !important; /* Full height minus navbar */
        background: white !important;
        z-index: 10000 !important; /* Increased z-index to ensure sidebar is on top */
        transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        box-shadow: 2px 0 16px rgba(0, 0, 0, 0.15) !important;
        overflow-y: auto !important;
        padding: 20px 0 !important;
        display: none !important; /* Hidden by default on mobile */
        visibility: hidden !important; /* Hidden by default on mobile */
    }

    /* Show sidebar when active */
    .sidebar.active {
        left: 0 !important;
        top: 64px !important;
        display: block !important;
        visibility: visible !important;
        transform: translateX(0) !important;
    }

    /* Sidebar items styling */
    .sidebar-item {
        display: flex !important;
        align-items: center !important;
        gap: 12px !important;
        padding: 14px 24px !important;
        color: #475569 !important;
        text-decoration: none !important;
        font-size: 15px !important;
        font-weight: 500 !important;
        transition: all 0.2s ease !important;
        border-left: 3px solid transparent !important;
    }

    .sidebar-item:hover {
        background: #f8fafc !important;
        color: #2563eb !important;
        border-left-color: #2563eb !important;
    }

    .sidebar-item.active {
        background: #eff6ff !important;
        color: #2563eb !important;
        border-left-color: #2563eb !important;
        font-weight: 600 !important;
    }

    .sidebar-item span:first-child {
        font-size: 20px !important;
    }

    /* ===== 4. FIX MOBILE CHAT CONTROLS ===== */
    .mobile-chat-controls {
        position: fixed !important;
        top: 64px !important; /* Below top nav */
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        padding: 10px 12px !important;
        background: white !important;
        border-bottom: 1px solid #e5e7eb !important;
        z-index: 997 !important;
        display: flex !important;
        gap: 10px !important;
        align-items: center !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03) !important;
        box-sizing: border-box !important; /* Include padding in height calculation */
    }

    .mobile-sidebar-toggle {
        min-width: 48px !important;
        min-height: 48px !important;
        padding: 0 !important;
        font-size: 22px !important;
        flex-shrink: 0 !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 10px !important;
        background: white !important;
        cursor: pointer !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        transition: all 0.2s ease !important;
        color: #1e293b !important;
        font-weight: bold !important;
    }

    .mobile-sidebar-toggle span {
        display: block !important;
        font-size: 22px !important;
        line-height: 1 !important;
    }

    .mobile-sidebar-toggle:hover {
        background: #f8fafc !important;
        border-color: #2563eb !important;
    }

    .mobile-sidebar-toggle:active {
        transform: scale(0.95) !important;
    }

    .mobile-chat-dropdown {
        flex: 1 !important;
        padding: 14px 16px !important;
        padding-right: 40px !important;
        font-size: 14px !important;
        font-weight: 600 !important;
        min-height: 48px !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 10px !important;
        background: white !important;
        cursor: pointer !important;
        color: #1e293b !important;
        appearance: none !important;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 12 12'%3E%3Cpath fill='%234B5563' d='M6 9L1 4h10z'/%3E%3C/svg%3E") !important;
        background-repeat: no-repeat !important;
        background-position: right 14px center !important;
    }

    .mobile-chat-dropdown:focus {
        outline: none !important;
        border-color: #2563eb !important;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1) !important;
    }

    /* ===== 5. FIX MAIN CONTENT AREA ===== */
    .main-content.responsive-main-content {
        margin-left: 0 !important;
        margin-top: 64px !important; /* Below top nav */
        padding: 0 !important;
        width: 100vw !important;
        overflow-x: hidden !important;
    }

    .chat-page-container {
        margin-top: 0 !important;
        padding-top: 0 !important;
        display: block !important;
        width: 100vw !important;
        overflow-x: hidden !important;
    }

    .chat-main {
        margin-top: 64px !important; /* Below mobile controls */
        padding-top: 0 !important;
        height: calc(100vh - 64px) !important; /* Only account for top nav */
        display: flex !important;
        flex-direction: column !important;
        overflow: hidden !important; /* Prevent scrolling on main container */
        box-sizing: border-box !important; /* Include padding in height calculation */
    }

    /* ===== 6. FIX CHAT HEADER ===== */
    .chat-header {
        padding: 12px 16px !important;
        flex-shrink: 0 !important;
    }

    .chat-header-content {
        flex-direction: column !important;
        gap: 10px !important;
    }

    .chat-header-title {
        font-size: 18px !important;
        line-height: 1.3 !important;
        margin: 0 0 4px 0 !important;
    }

    .chat-header-subtitle {
        font-size: 12px !important;
        line-height: 1.4 !important;
    }

    /* ===== 7. FIX CHAT MESSAGES AREA ===== */
    .chat-messages {
        flex: 1 !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
        padding: 12px !important;
        -webkit-overflow-scrolling: touch !important;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
        /* Prevent extra spacing at the end */
        scroll-padding-bottom: 0 !important;
    }

    /* ===== 8. FIX CHAT INPUT ===== */
    .chat-input-container {
        padding: 10px 12px !important;
        flex-shrink: 0 !important;
        background: white !important;
        border-top: 1px solid #e5e7eb !important;
    }

    .chat-input-wrapper {
        padding: 6px !important;
        gap: 6px !important;
    }

    .attachment-btn,
    .send-btn {
        width: 40px !important;
        height: 40px !important;
        min-width: 40px !important;
        min-height: 40px !important;
        font-size: 18px !important;
    }

    .chat-input {
        font-size: 14px !important;
        padding: 10px 12px !important;
    }

    .file-upload-info {
        margin-top: 4px !important;
    }

    .file-upload-info small {
        font-size: 10px !important;
    }

    /* ===== 9. FIX OVERLAY ===== */
    .sidebar-overlay {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        background: rgba(0, 0, 0, 0.5) !important;
        backdrop-filter: blur(2px) !important;
        z-index: 9999 !important; /* Increased z-index */
        display: none !important;
        opacity: 0 !important;
        visibility: hidden !important;
        pointer-events: none !important;
        transition: opacity 0.3s ease !important;
    }

    .sidebar-overlay.active {
        display: block !important;
        opacity: 1 !important;
        visibility: visible !important;
        pointer-events: auto !important;
    }

    /* ===== 10. FIX BODY SCROLL LOCK ===== */
    body.sidebar-open {
        overflow: hidden !important;
        position: fixed !important;
        width: 100% !important;
    }

    /* ===== 11. FIX CHAT SIDEBAR (RIGHT) ===== */
    .chat-sidebar {
        position: fixed !important;
        top: 64px !important; /* Below top nav */
        left: -100% !important;
        width: 85% !important;
        max-width: 320px !important;
        height: calc(100vh - 64px) !important; /* Full height minus navbar */
        z-index: 10001 !important; /* Increased z-index */
        background: white !important;
        overflow-y: auto !important;
        transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        box-shadow: 2px 0 16px rgba(0, 0, 0, 0.15) !important;
        padding: 0 !important;
        margin: 0 !important;
        display: none !important; /* Hidden by default on mobile */
        visibility: hidden !important; /* Hidden by default on mobile */
    }

    .chat-sidebar.active {
        left: 0 !important;
        display: block !important;
        visibility: visible !important;
        transform: translateX(0) !important;
    }

    /* ===== 12. HIDE DESKTOP COLLAPSE BUTTONS ===== */
    .sidebar-collapse-btn,
    .sidebar-expand-btn {
        display: none !important;
    }

    /* ===== 13. FIX WELCOME SCREEN ===== */
    .welcome-screen {
        padding: 24px 16px !important;
        text-align: center !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
    }

    .welcome-icon {
        font-size: 56px !important;
        margin-bottom: 16px !important;
        animation: bounce 2s infinite !important;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    .welcome-title {
        font-size: 20px !important;
        line-height: 1.3 !important;
        margin-bottom: 10px !important;
    }

    .welcome-subtitle {
        font-size: 13px !important;
        line-height: 1.6 !important;
        padding: 0 8px !important;
    }

    /* ===== 14. FIX MESSAGES ===== */
    .message {
        margin-bottom: 14px !important;
        gap: 8px !important;
    }

    .message-avatar {
        width: 32px !important;
        height: 32px !important;
        font-size: 14px !important;
    }

    .message-content {
        max-width: calc(100% - 40px) !important;
        padding: 12px 14px !important;
    }

    .message-text {
        font-size: 14px !important;
        line-height: 1.5 !important;
    }

    .message-time {
        font-size: 10px !important;
        margin-top: 4px !important;
    }

    /* ===== 15. PROJECT BUTTON ===== */
    .project-select-btn {
        width: 100% !important;
        padding: 10px 12px !important;
    }

    .project-context-icon {
        width: 32px !important;
        height: 32px !important;
        font-size: 16px !important;
    }

    .project-context-label {
        font-size: 9px !important;
    }

    .project-context-value {
        font-size: 13px !important;
    }

    .project-context-docs {
        font-size: 11px !important;
    }

    /* ===== 16. SIDEBAR TABS ===== */
    .sidebar-tabs {
        gap: 6px !important;
        margin-top: 8px !important;
    }

    .sidebar-tab {
        padding: 8px !important;
        font-size: 12px !important;
        border-radius: 8px !important;
    }

    /* ===== 17. CHAT HISTORY ===== */
    .chat-history-header {
        padding: 12px !important;
    }

    .chat-history-header h3 {
        font-size: 13px !important;
    }

    .chat-history-list {
        padding: 8px !important;
    }

    .history-item {
        padding: 10px !important;
        margin-bottom: 6px !important;
        border-radius: 8px !important;
    }

    .history-item-title {
        font-size: 12px !important;
    }

    .history-item-meta {
        font-size: 10px !important;
    }

    /* ===== 18. QUICK ACTIONS ===== */
    .system-prompts-section {
        padding: 12px !important;
    }

    .system-prompt-card {
        padding: 10px !important;
        margin-bottom: 6px !important;
        border-radius: 8px !important;
    }

    /* ===== 19. PROJECT MODAL ===== */

    
    .project-filter-content {
        width: 95vw !important;
        max-width: 95vw !important;
        max-height: 90vh !important;
        border-radius: 12px !important;
    }

    .project-filter-header {
        padding: 16px !important;
    }

    .project-filter-header h3 {
        font-size: 16px !important;
    }

    .project-filter-body {
        padding: 12px !important;
    }

    .project-option {
        padding: 12px !important;
    }

    .project-name {
        font-size: 14px !important;
    }

    /* ===== 20. TABLES ===== */
    .generated-table-container,
    .ai-table-wrap {
        overflow-x: auto !important;
        margin: 10px 0 !important;
    }

    .generated-table,
    .ai-table {
        font-size: 11px !important;
    }

    .generated-table th,
    .generated-table td {
        padding: 6px 4px !important;
        font-size: 10px !important;
    }

    /* ===== 21. ACTION BUTTONS ===== */
    .part-actions {
        padding: 10px !important;
        margin: 12px 0 !important;
    }

    .action-buttons {
        flex-direction: column !important;
        gap: 6px !important;
    }

    .action-buttons .btn {
        width: 100% !important;
        padding: 10px 14px !important;
        font-size: 13px !important;
    }

    /* ===== 22. SCROLLBAR ===== */
    .chat-messages::-webkit-scrollbar,
    .chat-history-list::-webkit-scrollbar,
    .sidebar::-webkit-scrollbar {
        width: 4px !important;
    }

    .chat-messages::-webkit-scrollbar-track,
    .chat-history-list::-webkit-scrollbar-track,
    .sidebar::-webkit-scrollbar-track {
        background: #f3f4f6 !important;
    }

    .chat-messages::-webkit-scrollbar-thumb,
    .chat-history-list::-webkit-scrollbar-thumb,
    .sidebar::-webkit-scrollbar-thumb {
        background: #d1d5db !important;
        border-radius: 10px !important;
    }
}

/* ===== TABLET (481px - 768px) ===== */
@media (min-width: 481px) and (max-width: 768px) {
    .mobile-chat-controls {
        display: flex !important;
        padding: 12px 16px !important;
    }

    .sidebar-toggle {
        display: flex !important;
        position: fixed !important;
        top: 72px !important;
        left: 16px !important;
        z-index: 10002 !important; /* Increased z-index to ensure button is on top */
        visibility: visible !important; /* Ensure button is visible */
    }

    .mobile-sidebar-toggle {
        min-width: 48px !important;
        min-height: 48px !important;
    }

    .chat-sidebar {
        width: 320px !important;
        max-width: 40% !important;
    }

    .chat-main {
        margin-top: 64px !important;
    }
}

/* ===== LANDSCAPE MODE FIX ===== */
@media (max-width: 768px) and (orientation: landscape) {
    .sidebar,
    .chat-sidebar {
        width: 50% !important;
        max-width: 320px !important;
    }

    .chat-main {
        height: calc(100vh - 120px) !important;
    }

    .welcome-screen {
        padding: 20px 16px !important;
    }

    .welcome-icon {
        font-size: 40px !important;
    }

    .chat-messages {
        padding: 10px !important;
    }
}

/* ===== VERY SMALL SCREENS (< 360px) ===== */
@media (max-width: 360px) {
    .sidebar-toggle {
        min-width: 44px !important;
        min-height: 44px !important;
        font-size: 18px !important;
        padding: 8px 12px !important;
    }

    .mobile-sidebar-toggle {
        min-width: 44px !important;
        min-height: 44px !important;
        font-size: 20px !important;
    }

    .mobile-chat-dropdown {
        font-size: 13px !important;
        padding: 12px 14px !important;
    }

    .chat-header-title {
        font-size: 16px !important;
    }

    .welcome-title {
        font-size: 18px !important;
    }

    .welcome-subtitle {
        font-size: 12px !important;
    }

    .chat-sidebar {
        width: 100% !important;
        max-width: 100% !important;
    }
}

/* ===== ENSURE DESKTOP NOT AFFECTED (> 768px) ===== */
@media (min-width: 769px) {
    /* Hide mobile-only elements on desktop */
    .sidebar-toggle {
        display: none !important;
    }

    .mobile-chat-controls {
        display: none !important;
    }

    /* Reset sidebar to normal desktop behavior */
    .sidebar {
        position: fixed !important;
        left: 0 !important;
        top: 64px !important;
        width: 240px !important;
    }
    
    .chat-sidebar {
        position: relative !important;
        left: 0 !important;
    }

    .sidebar-overlay {
        display: none !important;
    }
}

/* ===== SMOOTH TRANSITIONS ===== */
@media (max-width: 480px) {
    .sidebar,
    .chat-sidebar,
    .sidebar-overlay {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }
}

/* ===== ACCESSIBILITY ===== */
@media (max-width: 480px) {
    .sidebar-toggle:focus,
    .mobile-sidebar-toggle:focus,
    .mobile-chat-dropdown:focus {
        outline: 2px solid #2563eb !important;
        outline-offset: 2px !important;
    }

    /* Touch targets */
    .history-item,
    .project-option,
    .system-prompt-card,
    .sidebar-tab,
    .action-buttons .btn {
        min-height: 44px !important;
        -webkit-tap-highlight-color: rgba(59, 130, 246, 0.1) !important;
    }
}

/* ===== REDUCED MOTION ===== */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* ===== HIGH CONTRAST MODE ===== */
@media (prefers-contrast: high) {
    .message-content,
    .project-option,
    .history-item {
        border-width: 2px !important;
    }
}

/* ===== TOUCH DEVICE OPTIMIZATIONS ===== */
@media (hover: none) and (pointer: coarse) {
    .mobile-sidebar-toggle,
    .attachment-btn,
    .send-btn,
    .sidebar-toggle {
        -webkit-tap-highlight-color: rgba(59, 130, 246, 0.1) !important;
    }

    .history-item:hover,
    .project-option:hover,
    .system-prompt-card:hover {
        transform: none !important;
    }

    .history-item:active,
    .project-option:active,
    .system-prompt-card:active {
        transform: scale(0.98) !important;
        opacity: 0.9 !important;
    }
}

/* ===== iOS SAFE AREAS ===== */
@supports (-webkit-touch-callout: none) {
    @media (max-width: 480px) {
        .chat-input-container {
            padding-bottom: max(10px, env(safe-area-inset-bottom)) !important;
        }

        .sidebar,
        .chat-sidebar {
            padding-bottom: max(0px, env(safe-area-inset-bottom)) !important;
        }
    }
}

/* ===== PRINT STYLES ===== */
@media print {
    .chat-sidebar,
    .chat-header,
    .chat-input-container,
    .mobile-chat-controls,
    .sidebar-overlay,
    .sidebar-toggle {
        display: none !important;
    }

    .chat-page-container {
        grid-template-columns: 1fr !important;
        height: auto !important;
    }

    .chat-messages {
        padding: 0 !important;
        background: white !important;
    }

    .message {
        page-break-inside: avoid !important;
    }
}

/* ==================== END OF CHATBOT RESPONSIVE CSS ==================== */

